name: KAIROS CI

on:
  workflow_dispatch:
  push:
    paths:
      - '08-agents/KAIROS/**'
      - '.github/workflows/kairos-ci.yml'

jobs:
  pre-commit:
    if: ${{ hashFiles('08-agents/KAIROS/.pre-commit-config.yaml') != '' }}
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: 08-agents/KAIROS
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install pre-commit
        run: pip install pre-commit
      - name: Run pre-commit
        run: pre-commit run --all-files

  validation:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: 08-agents/KAIROS
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install deps
        run: pip install jsonschema pyyaml
      - name: JSON Schema self-check
        if: ${{ hashFiles('08-agents/KAIROS/schemas/frontmatter.schema.json') != '' }}
        run: python3 scripts/json_schema_check.py schemas/frontmatter.schema.json
      - name: Frontmatter fixtures validate
        if: ${{ hashFiles('08-agents/KAIROS/tests/fixtures/frontmatter/good/*.json') != '' }}
        run: python3 scripts/nr_fm.py tests/fixtures/frontmatter
      - name: Make ci-validate
        if: ${{ hashFiles('08-agents/KAIROS/Makefile') != '' }}
        run: make ci-validate
